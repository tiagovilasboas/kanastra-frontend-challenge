#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Husky: Verificando qualidade do código..."

# 1. Executar lint-staged para arquivos staged (inclui ESLint + Prettier)
echo "🎯 Executando lint-staged..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo "❌ lint-staged falhou. Corrija os problemas antes do commit."
  exit 1
fi

# 2. Verificar TypeScript
echo "🔧 Verificando TypeScript..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "❌ TypeScript encontrou erros. Corrija-os antes do commit."
  exit 1
fi

# 3. Executar testes unitários
echo "🧪 Executando testes unitários..."
npm run test -- --run --reporter=verbose
if [ $? -ne 0 ]; then
  echo "❌ Testes unitários falharam. Corrija-os antes do commit."
  exit 1
fi

echo "✅ Pre-commit: Todos os checks passaram!"
