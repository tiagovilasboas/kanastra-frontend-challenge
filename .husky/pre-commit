#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Husky: Verificando qualidade do cÃ³digo..."

# 1. Executar lint-staged para arquivos staged (inclui ESLint + Prettier)
echo "ğŸ¯ Executando lint-staged..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo "âŒ lint-staged falhou. Corrija os problemas antes do commit."
  exit 1
fi

# 2. VerificaÃ§Ã£o rigorosa de lint em todo o projeto
echo "ğŸ” VerificaÃ§Ã£o rigorosa de lint..."
npm run lint:strict
if [ $? -ne 0 ]; then
  echo "âŒ Lint rigoroso encontrou problemas. Execute 'npm run quality-fix' para corrigir."
  exit 1
fi

# 3. Verificar formataÃ§Ã£o do Prettier
echo "ğŸ¨ Verificando formataÃ§Ã£o..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Prettier encontrou problemas de formataÃ§Ã£o. Execute 'npm run format' para corrigir."
  exit 1
fi

# 4. Verificar TypeScript
echo "ğŸ”§ Verificando TypeScript..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript encontrou erros. Corrija-os antes do commit."
  exit 1
fi

# 5. Executar testes unitÃ¡rios
echo "ğŸ§ª Executando testes unitÃ¡rios..."
npm run test -- --run --reporter=verbose
if [ $? -ne 0 ]; then
  echo "âŒ Testes unitÃ¡rios falharam. Corrija-os antes do commit."
  exit 1
fi

# 6. Verificar build
echo "ğŸ”¨ Verificando build..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build falhou. Corrija os problemas antes do commit."
  exit 1
fi

echo "âœ… Pre-commit: Todos os checks passaram!"
