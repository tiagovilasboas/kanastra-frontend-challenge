#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Husky: Verificando qualidade antes do push..."

# 1. Verificar se hÃ¡ erros de linting
echo "ğŸ“ Verificando ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint encontrou erros. Corrija-os antes do push."
  exit 1
fi

# 2. Verificar TypeScript
echo "ğŸ”§ Verificando TypeScript..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript encontrou erros. Corrija-os antes do push."
  exit 1
fi

# 3. Executar testes unitÃ¡rios
echo "ğŸ§ª Executando testes unitÃ¡rios..."
npm run test -- --run --reporter=verbose
if [ $? -ne 0 ]; then
  echo "âŒ Testes unitÃ¡rios falharam. Corrija-os antes do push."
  exit 1
fi

# 4. Verificar se o build funciona
echo "ğŸ”¨ Verificando build..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build falhou. Corrija os problemas antes do push."
  exit 1
fi

# 5. Executar testes E2E (se disponÃ­vel)
echo "ğŸŒ Verificando testes E2E..."
if npm run test:e2e 2>/dev/null; then
  echo "âœ… Testes E2E passaram!"
else
  echo "âš ï¸  Testes E2E nÃ£o disponÃ­veis ou falharam. Continuando..."
fi

echo "âœ… Pre-push: Todos os checks passaram! Pode fazer push com seguranÃ§a." 